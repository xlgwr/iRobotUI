<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/cshtml; charset=utf-8" />
    <title>@ViewBag.Title</title>
    <link href="@Url.Content("~/Content/themes/xlgwr/xlgwr.all.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Areas/GldOne/Content/GldOne.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/themes/redmond/jquery.ui.all.css")" title="theme" rel="stylesheet" type="text/css" />
    <script src="@Url.Content("~/Scripts/jquery-1.6.2.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery-ui-1.8.14.custom.min.js")" type="text/javascript"> </script>
    <script src="../../../../Scripts/jquery-1.6.2.min.js" language="javascript" type="text/javascript"></script>
    <script src="../../../../Scripts/jquery-ui-1.8.14.custom.min.js" language="javascript"
        type="text/javascript"></script>
    <script type="text/javascript">
        $(function () {
            //theme switcher
            var linktheme = $(parent.document).find('link[title="theme"]').first().attr("href");
            //alert(linktheme.toString());
            $('link[title="theme"]').replaceWith('<link href="' + linktheme + '" title="theme" rel="Stylesheet" type="text/css" />');
            $('iframe').each(function () {
                var thissrc = $(this).attr("src");
                $(this).attr("src", thissrc);
            });
            /////////////////////datetime
            $("input[name='送货日期'],input[name='交货日期']").datepicker({ minDate: 0, maxDate: "+6M +10D" })

        });
    </script>
    <script type="text/javascript">

        $(function () {
            //变量

            var titles = "";
            //////////////////////////////////////////////////////////////////////////
            $("input:button").button();
            $("#tools-1 td a").button();
            //////////////////////////////////////////////////////////////////////////
            $("#dialog_tools,#dialog_Create,#dialog_select").dialog({
                autoOpen: false,
                zIndex: 3999,
                buttons: {
                    "   确  定  ": function () {
                        $(this).dialog("close");
                        //           location.href = "/GldOne/ProductionSchedule/CreateProcessInspection";
                        //           location = location;
                        //            window.location.reload();
                        //            location.reload();
                    }
                },
                open: function (event, ui) {
                    var $dialog = $(this);
                    // 最大化,最小化,图标修改处
                    var atext = $(".ui-dialog-titlebar-close").replaceWith('<p class="ui-xlgwr"><span class="ui-icon ui-icon-minusthick">minusthick</span> <span class="ui-icon ui-icon-extlink">extlink</span><span class="ui-icon ui-icon-closethick">close</span></p>');
                    //最大化,最小化事件
                    $(".ui-xlgwr>span").click(function () {
                        var spantext = $(this).text();
                        //alert("ok:ui-span" + spantext);
                        //最大化
                        if (spantext == "extlink") {

                            if (window.screen) {              //判断浏览器是否支持window.screen判断浏览器是否支持screen
                                var myw = screen.availWidth;   //定义一个myw，接受到当前全屏的宽
                                var myh = screen.availHeight;  //定义一个myw，接受到当前全屏的高
                                //window.moveTo(0, 0);           //把window放在左上脚
                                //window.resizeTo(myw, myh);     //把当前窗体的长宽跳转为myw和myh
                                $dialog.dialog({
                                    position: ['left', 'top'],
                                    width: myw * 0.8,
                                    height: myh * 0.8
                                });

                            } else {
                                $dialog.dialog({
                                    position: 'center',
                                    width: 800,
                                    height: 600
                                });
                            }

                            //最小化
                        } else if (spantext == "minusthick") {
                            $dialog.dialog({
                                position: 'top',
                                width: 210,
                                height: 210
                            });
                            //退出
                        } else if (spantext == "close") {
                            $dialog.dialog("close");
                        } else {
                            alert("请选择正确的图标,谢谢.");
                        }
                    });
                },
                close: function () {

                    //$("#dialogtools").text("加载中...");
                    $(".loadmessage").hide();
                }
            });
            //////////////////////////////////////////////////////////////////////////

            ///////////////////////////////刷选/////////////////////////////////////
            $("#btnSelect").click(function () {
                var selectKey2 = $("#intext").val().toString();
                var hrefsSelect = $("#dialogselect").attr("src-data").toString() + selectKey2.toString();
                //iframe加载src
                $("#dialogselect").attr("src", hrefsSelect);
                $("#dialog_select").dialog("option", "title", titles + productid.toString());

            });
            //////////////////////////////////////////////////////////////////////////
            /****//加载要选择的对象.如：客户ＩＤ，调用该客户的相关信息//*****/
            $(".selecticon").click(function () {

                //alert("ok");

                // alert(likeText.toString());

                //获取class 的值
                var flag = $(this).attr("class")//.hasClass('WOPID');
                //alert(flag.toString());

                var hrefs = "";
                var titles = "";
                //面页转换,进入的面不同
                if (flag == "selecticon PC ui-icon ui-icon-search") {
                    // alert("flag:productid PI");
                    titles = "客户资料->客户代号Like->"
                    hrefs = "/GldOne/ProductInformation/GetProductCustomerInformationById/";
                } else if (flag == "selecticon WOPID") {
                    titles = "工单详细资料->工单单号Like->"
                    hrefs = "/GldOne/ProductionSchedule/EditProcessInspection/";
                } else {
                    alert("选择错误.icon");
                }
                //获取ID号 //获取输入input的值
                var productid = $(this).parent().find('input:eq(0)').val();

                // alert(productid.toString());

                if (productid == "") {
                    titles += "前N条记录,请输入要筛选的数据.谢谢.";
                }
                //var productid = $(this).text().toString();
                //连接href
                var Id = hrefs + productid.toString();

                //alert(Id.toString());
                //打开新窗口
                $("#dialog_select").dialog({
                    width: 515,
                    height: 520
                });
                $("#dialog_select").dialog("open");
                //iframe
                $("#dialogselect").attr("src-data", hrefs.toString());

                $("#dialogselect").attr("src", Id.toString());
                //endiframe
                $("#dialog_select").dialog("option", "title", titles + productid.toString());


            });
            //////////////////////////////////////////////////////////////////////////
            $("input:submit").button();
            $("#DetailsF5").click(function () {
                window.document.location.reload();
            });
            //////////////////////////新增按钮操作及////////////
            $("#DetailsCreate").click(function () {
                var $detailsiframe = $("#detailsCreate");
                //////////////////////////////
                var editsrc = $detailsiframe.attr("data-createsrc");
                //alert(editsrc.toString());
                ///////////////////////////
                $detailsiframe.attr("src", editsrc);
                ////////////////////////////
            });
            //////////删除
            $("#Detailsdelete").click(function () {
                var $detailsiframe = $("#detailsCreate");
                //////////////////////////////
                var id = $detailsiframe.attr("data-id");
                if (id.toString() != "#") {
//                    $.ajax({
//                        url: "/GldOne/OrderManagement/DeleteOrderDetailsById/" + id.toString(),
//                        success: function (data) {
//                            alert(data.toString());
//                            // alert("选择工单:" + id.toString() + " 成功...");
//                            // location.href = "/GldOne/ProductionSchedule/CreateProcessInspection";
//                        }
//                    });
                    var editsrc = $detailsiframe.attr("data-deletesrc") + id.toString();
                    //alert(editsrc.toString());
                    /////////////////////////
                    $detailsiframe.attr("src", editsrc);
                } else {
                    alert("请选择明细资料,谢谢.");
                }

                ////////////////////////////
            });
            //////////////////////////////////////////////////////////////////////////

            $('.DataItem tr:gt(0)').click(function () {
                //alert("click tr");
                var checked = $(this).find(":checkbox").attr("checked");
                //alert(checked);
                if (checked == "checked") {
                    $(this).removeClass();
                    $(this).find(':checkbox').removeAttr("checked");


                } else {
                    $('.DataItem tr:gt(0) :checkbox').removeAttr("checked");
                    $('.DataItem tr:gt(0)').removeClass();
                    $(this).find(':checkbox').attr("checked", "checked");
                    $(this).toggleClass();
                    //////////////////////////////////////////////////////id
                    var id = $(this).find(':checkbox').val();

                    //var WOI = $(this).find(':checkbox').hasClass('WOI');
                    //alert(id.toString());
                    ///
                    //获取class 的值
                    var flag = $(this).find(':checkbox').attr("class")//.hasClass('WOPID');
                    //alert(flag.toString());
                    //面页转换,修改值,进入的面不同
                    if (flag == "selectOD") {
                        var $detailsiframe = $("#detailsCreate");
                        //////////////////////////////
                        $detailsiframe.attr("data-id", id.toString());
                        var editsrc = $detailsiframe.attr("data-editsrc") + id.toString();
                        //alert(editsrc.toString());
                        ///////////////////////////
                        $detailsiframe.attr("src", editsrc);

                        //////////////////////////////////

                    } else if (flag == "selectPI") {
                        //选择对象Id,进行Create,edit,delete,details操作
                        $(parent.document).find("#tools-1-tr-1-i").attr("data-id", id.toString());

                    } else if (flag == "WOI") {
                        //alert("ok");
                        $.ajax({
                            url: "/GldOne/ProductionSchedule/SelectWorkOrderInformationmodel/" + id.toString(),
                            success: function (data) {
                                // alert("选择工单:" + id.toString() + " 成功...");
                                // location.href = "/GldOne/ProductionSchedule/CreateProcessInspection";
                            }
                        });
                    } else {
                        //alert("选择错误.dialog");
                    }

                    ///

                }
                $(this).toggleClass("click");


            });
            //***********************************************
            //////////////////////////////////////////////////////////////////////////
            //            $('.DataItem tr:gt(0)').dblclick(function () {
            //                alert("dbclick tr");
            //                $(this).dialog("close");
            //                
            //            });

            //////////////////////////////////////////////////////////////////////////
            $(".loadmessage").hide();
            ///**********************
            $(".pages").click(function () {
                $(".loadmessage").fadeIn();
                var loadhref = $(this).attr("href-data");
                location.href = loadhref.toString();
                $(".loadmessage").fadeOut('slow');
                $(".loadmessage").hide();

            });

            //////////////////////////////////////////////////////////////////////////
            //*********************************************

        })
        
    </script>
</head>
<body class="ui-widget-content none" style="min-height: 550px!important;">
    <div id="pagebody">
        <div id="main" class="leftmain">
            <!--nav_pt_n_content引用其它页面-->
            @RenderBody()
            <div class="left">
                <input id="DetailsCreate" type="button" value="新增明细" />
                <input id="DetailsF5" type="button" value="刷新明细" />
                @* <input id="Detailsedit" type="button" value="修改" />*@
                <input id="Detailsdelete" type="button" value="删除明细" />
            </div>
        </div>
    </div>
    <div id="footer">
        <div class="loadmessage">
            加载中...
        </div>
        <div id="dialog_tools">
            <iframe id="dialogtools" frameborder="0" src-data="">加载中...</iframe>
            @*   @{Html.RenderAction("GetWorkOrderInformation", new { id = "01" });}*@
        </div>
        @* ////加载要选择的对象.如：客户ＩＤ，调用该客户的相关信息///*@
        <div id="dialog_select">
            <div class="searchdiv">
                <b id="searchTitle" class="none ui-widget-content">代号(或名称):</b>
                <input id="intext" class="none ui-widget-content" type="text" />
                <input id="btnSelect" type="button" value="筛 选" />
            </div>
            <hr />
            <iframe id="dialogselect" class="left" frameborder="0" src-data="">加载中...</iframe>
            @*   @{Html.RenderAction("GetWorkOrderInformation", new { id = "01" });}*@
        </div>
        <div id="dialog_Create" class="relative">
            <div id="dialogCreate" class="relative">
                <div id="selectcontent">
                    加载中...</div>
            </div>
        </div>
    </div>
</body>
</html>
